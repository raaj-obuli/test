<html>
<body>
<pre id="result">Connecting...</pre>
<script type="text/javascript" src="//code.jquery.com/jquery-git.js"></script>
<script type="text/javascript">
!function(e){function t(){n();for(var e=0;e<p.length;e++)p[e].close();p=[]}function n(){e.ajax("http://fastcast.prod.us-east-1.aws.espn.com/public/rotationip").done(function(t){if(void 0!==t){var n=t.indexOf(",");if(n>0){var s=t.substring(n+1);l.tries++,e.ajax("http://proxy.espn.com/espn/util/cors?region=east").done(function(e){r=(new Date).getTime(),a(e,s)}),e.ajax("http://proxy.espn.com/espn/util/cors?region=west").done(function(e){a(e,s)})}}})}function a(e,t){if(void 0!==e.nodes&&e.nodes.length>0){for(var n=0,a=0;a<e.nodes.length;a++){var o=e.nodes[a];o.rotationState>=2&&(s(o.publicIP,t,o.host),n++)}i.append("\n c:"+n)}}function s(t,n,a){var s=t+":9571/FastcastService/pubsub/profiles/12000";s+="?TrafficManager-Token="+n,void 0===l[t]?l[t]={attempts:1,errors:0,lastTry:new Date,last10:[],host:a,trying:!0}:(l[t].attempts++,l[t].lastTry=new Date,l[t].trying=!0);var o=new WebSocket("ws://"+s),f=function(t){if(t){var n=t.target.url.replace("ws://","").split("/")[0].replace(":9571","");if("open"==t.type)o.send('{"op":"C"}');else if("close"==t.type){if(1006===t.code){var a=(new Date).getTime()-r;if(l[n].trying)l[n].last10.push(0),l[n].errors++,i.append("nc: "+n.split(".").join("#1a1")+" "+new Date);else{var s=l[n].last10;s.pop(),s.push(Math.floor(a/1e3)),l[n].last10=s,i.append("k: "+n.split(".").join("#1a1")+" | "+a+"ms | ")}c=!0}}else if(t.data)try{var p=JSON.parse(t.data);"C"==p.op&&200==p.rc&&p.sid?(l[n].last10.push(1),l[n].trying=!1,o.send('{"tc":"event-topevents", "op":"S", "sid":"'+p.sid+'"}'),connected=!0):p.useCDN&&(i.append("$upd"),e.ajax(p.pl).always(function(e,t,n){e.status&&i.append("e:"+e.status)}))}catch(t){}}};o.onmessage=f,o.onclose=f,o.onerror=f,o.onopen=f,p.push(o)}function o(e){console.log(e)}var r,i=e("#result"),p=[],l={tries:0},c=!1;t(),setInterval(t,6e4),setInterval(function(){var e="";if(c){for(var t in l){var n=l[t];if(void 0!==n.last10&&n.last10.length>10){for(var a=n.last10;a.length>10;)a.shift();n.last10=a;for(var s=0,r=0;r<n.last10.length;r++)0==n.last10[r]&&s++;var i=s/n.last10.length*100;i>50&&(e+=t+" >50err")}}o("```node connection update: "+JSON.stringify(l).replace(",","\n").replace(/"/g,"").replace(/},/g,"\n")+"```"),c=!1}else o("update: no connection errors in the last 10mins")},6e5)}(jQuery);
</script>
<body>
</html>
